<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.myapp.mapper.GroupBoardMapper">

    <insert id="insert">
        <selectKey keyProperty="postNo" order="AFTER" resultType="int">
        SELECT "ISEQ$$_74695".CURRVAL FROM dual
        </selectKey>

        <!-- INSERT INTO tbl_qnaboard (title, content) 
        VALUES (#{title}, #{content}) -->

        INSERT INTO tbl_groupboard (nickName, title, content, area, memberNum, recruitStatus, startDate, endDate) 
        VALUES (#{nickName}, #{title}, #{content}, #{area}, #{memberNum}, #{recruitStatus}, #{startDate}, #{endDate})
    </insert>

    <select id="select" resultType="org.zerock.myapp.domain.GroupBoardVO">
        SELECT * 
        FROM tbl_groupboard
        WHERE postno = #{postNo}
    </select>

    <delete id="delete">
        DELETE FROM tbl_groupboard
        WHERE postno = #{postNo}
    </delete>

    <update id="update">
        UPDATE tbl_groupboard
        SET title = #{title}, 
        	nickName = #{nickName},
            content = #{content}, 
            modifydate = current_date,
            area = #{area}, 
            memberNum = #{memberNum}, 
            recruitStatus = #{recruitStatus}, 
            startDate = #{startDate}, 
            endDate = #{endDate}
        WHERE postno = #{postNo}
    </update>
    
    <!-- 7. 카테고리별 검색 기능 -->
	<select id="searchList" resultType="org.zerock.myapp.domain.GroupBoardVO">
	    SELECT 
	    /*+ index_desc(tbl_groupboard) */ *
	    FROM TBL_GROUPBOARD
	    <where>
	        <if test="area != null">
	            AND area = #{area}
	        </if>
	        <if test="memberNum != null">
	            AND memberNum = #{memberNum}
	        </if>
	        <if test="recruitStatus != null">
	            AND recruitStatus = #{recruitStatus}
	        </if>
	        <if test="startDate != null">
	            AND startDate = #{startDate}
	        </if>
	        <if test="endDate != null">
	            AND endDate = #{endDate}
	        </if>
	    </where>
	    OFFSET (#{cri.currPage} - 1) * #{cri.amount} ROWS
	    FETCH NEXT #{cri.amount} ROWS ONLY
	</select>
	
	<!-- ... -->

</mapper>