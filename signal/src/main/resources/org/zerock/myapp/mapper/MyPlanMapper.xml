<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

    <mapper namespace="org.zerock.myapp.mapper.MyPlanMapper">
   
   <!-- 
    <insert id="make">
        <selectKey keyProperty="planNo" order="AFTER" resultType="int">
            SELECT "ISEQ$$_74701".CURRVAL FROM dual  
        </selectKey>
            INSERT INTO TBL_MYPLAN (PLANNAME, STARTDATE, ENDDATE, NICKNAME, DURATION) VALUES (#{planName}, TO_DATE(#{startDate}, 'yyyy-MM-dd'), TO_DATE(#{endDate}, 'yyyy-MM-dd'), #{nickName}, (TO_DATE(#{endDate}, 'yyyy-MM-dd') - TO_DATE(#{startDate}, 'yyyy-MM-dd'))+1)
    </insert>
     -->
     <insert id="make" >
        <selectKey keyProperty="planNo" order="AFTER" resultType="int">
            SELECT "ISEQ$$_74701".CURRVAL FROM dual  
        </selectKey>
            INSERT INTO TBL_MYPLAN (PLANNAME, STARTDATE, ENDDATE, NICKNAME, DURATION) 
            VALUES (#{planName},#{startDate}, #{endDate}, #{nickName}, (to_date(#{endDate}, 'yyyy-MM-dd')-to_date(#{startDate}, 'yyyy-MM-dd')))
    </insert>


    <select id="select">
        SELECT * FROM TBL_MYPLAN WHERE PLANNO = #{planNo}
    </select>
    
    
    <select id="selectList" resultType="org.zerock.myapp.domain.MyPlanVO">
   		SELECT * 
		FROM tbl_myplan 
		WHERE nickName = #{nickName} 
		ORDER BY startDate ASC 
		OFFSET ( #{cri.currPage} - 1 ) * #{cri.amount} ROWS 
		FETCH NEXT #{cri.amount} ROWS ONLY
    </select> 
    

    </mapper>